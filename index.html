<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simulador Virtual NR-35 ‚Äì Ancoragens</title>
  <style>
    :root{
      --bg1:#0a0f1c;--bg2:#1a1f35;--bg3:#252b42;
      --c1:#00d4ff;--c2:#00ff88;--cy:#ffb800;--cr:#ff4757;
      --t1:#fff;--t2:#b8c2cc;--t3:#7d8b96;--glass:rgba(255,255,255,.08);--glassb:rgba(255,255,255,.18)
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(135deg,var(--bg1),var(--bg2) 55%,var(--bg3));color:var(--t1);min-height:100vh}
    .header{padding:20px 24px;border-bottom:1px solid var(--glassb);backdrop-filter:blur(18px)}
    .header>div{max-width:1400px;margin:0 auto;display:flex;gap:14px;align-items:center;justify-content:space-between}
    h1{font-size:24px;font-weight:900;background:linear-gradient(45deg,var(--c1),var(--c2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .badge{padding:8px 14px;border-radius:999px;border:1px solid rgba(255,184,0,.35);color:var(--cy);background:rgba(255,184,0,.12);font-weight:800}

    .main{max-width:1400px;margin:0 auto;padding:22px;display:grid;grid-template-columns:420px 1fr;gap:22px}
    @media(max-width:1200px){.main{grid-template-columns:1fr}}
    .panel{background:var(--glass);border:1px solid var(--glassb);border-radius:18px;padding:18px}
    .title{display:flex;align-items:center;gap:10px;margin-bottom:12px;font-weight:900}
    .title:before{content:"";width:4px;height:18px;border-radius:2px;background:linear-gradient(45deg,var(--c1),var(--c2))}
    .row{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center;margin:10px 0}
    .label{font-size:14px;font-weight:800}
    .hint{font-size:12px;color:var(--t3)}
    .slider{-webkit-appearance:none;width:100%;height:6px;border-radius:4px;background:linear-gradient(90deg,#1a2237,#141a2c);outline:none}
    .slider::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:linear-gradient(45deg,var(--c1),var(--c2));box-shadow:0 4px 12px rgba(0,212,255,.35);cursor:pointer}
    .input{width:110px;padding:10px;border-radius:10px;border:1px solid var(--glassb);background:rgba(255,255,255,.05);color:var(--t1);font-weight:800;text-align:center}
    .select{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--glassb);background:rgba(255,255,255,.05);color:var(--t1);font-weight:800}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
    .btn{border:0;border-radius:12px;padding:14px 16px;font-weight:900;cursor:pointer}
    .btn-primary{background:linear-gradient(45deg,var(--c1),var(--c2));color:#07131a}
    .btn-ghost{background:rgba(255,255,255,.08);border:1px solid var(--glassb);color:var(--t1)}

    .kpis{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:8px}
    .kpi{background:rgba(0,0,0,.18);border:1px solid var(--glassb);border-radius:12px;padding:14px;text-align:center}
    .kpi .t{font-size:11px;color:var(--t3);text-transform:uppercase;font-weight:900;letter-spacing:.4px;margin-bottom:6px}
    .kpi .v{font-size:20px;font-weight:900}
    .tag{display:inline-block;margin-top:4px;font-size:10px;padding:4px 8px;border-radius:999px;border:1px solid}
    .safe{color:#00ff88;border-color:#00ff88;background:rgba(0,255,136,.16)}
    .warn{color:#ffb800;border-color:#ffb800;background:rgba(255,184,0,.16)}
    .dang{color:#ff4757;border-color:#ff4757;background:rgba(255,71,87,.18)}

    /* Palco */
    .stage{position:relative;height:720px;border-radius:20px;border:1px solid var(--glassb);overflow:hidden;background:linear-gradient(180deg,#8fd3ff 0%,#6aa7c5 42%,#3a6786 64%,#243b4a 78%,#1a1a1a 100%)}
    .building{position:absolute;right:0;top:0;width:42%;height:100%;background:linear-gradient(45deg,#2c3e50,#34495e);clip-path:polygon(16% 0,100% 0,100% 100%,0 100%);opacity:.78}
    .grid{position:absolute;right:7.5%;top:8%;width:28%;height:84%;
      background:
       repeating-linear-gradient(0deg,transparent 0,transparent 52px,rgba(255,255,255,.22) 52px,rgba(255,255,255,.22) 54px),
       repeating-linear-gradient(90deg,transparent 0,transparent 52px,rgba(255,255,255,.22) 52px,rgba(255,255,255,.22) 54px);
    }
    .ground{position:absolute;left:0;right:0;bottom:0;height:120px;background:linear-gradient(#8b4513,#654321 55%,#3e2723)}

    .platform{position:absolute;left:15%;width:40%;height:16px;background:linear-gradient(90deg,#1e88e5,#42a5f5);border-radius:8px;box-shadow:0 4px 16px rgba(30,136,229,.36),inset 0 2px 0 rgba(255,255,255,.28);z-index:6}
    .platform:before{content:"PLATAFORMA";position:absolute;bottom:22px;left:0;font-size:12px;font-weight:900;color:#7fd3ff;text-shadow:0 2px 8px rgba(0,0,0,.7)}

    .worker{position:absolute;width:118px;height:238px;z-index:12;transform-origin:50% 15%;transition:all .6s cubic-bezier(.25,.46,.45,.94)}
    .svg{width:100%;height:100%;filter:drop-shadow(0 10px 24px rgba(0,0,0,.45))}

    /* Ancoragens: cart√µes posicionados via JS */
    .anchors{position:absolute;right:15%;top:6%;width:120px;height:82%;z-index:15}
    .anchor{position:absolute;width:100px;height:100px;border-radius:16px;background:rgba(10,15,28,.82);border:2px solid transparent;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:transform .25s,border-color .25s,background .25s}
    .anchor:hover{transform:scale(1.06) translateX(-4px);border-color:var(--c1)}
    .anchor.selected{transform:scale(1.1) translateX(-6px);box-shadow:0 0 24px rgba(0,212,255,.4);background:rgba(0,212,255,.15);border-color:var(--c1)}
    .anchor .icon{width:38px;height:38px;border-radius:50%;display:grid;place-items:center;background:linear-gradient(45deg,var(--c1),var(--c2));margin-bottom:8px}
    .anchor .icon:before{content:"‚öì";font-size:19px;color:#fff}
    .anchor .label{font-size:12px;font-weight:900;text-align:center;line-height:1.1}

    /* SVG rope + badge dist√¢ncia */
    .ropeSvg{position:absolute;inset:0;z-index:10;pointer-events:none}
    .dist-badge{position:absolute;z-index:11;padding:4px 8px;border-radius:999px;font-size:11px;font-weight:900;background:rgba(0,0,0,.35);border:1px solid var(--glassb)}

    .result{position:absolute;right:24px;top:18px;padding:10px 14px;border-radius:999px;font-weight:900;border:2px solid;backdrop-filter:blur(10px)}
    .r-safe{color:#00ff88;border-color:#00ff88;background:rgba(0,255,136,.12)}
    .r-warn{color:#ffb800;border-color:#ffb800;background:rgba(255,184,0,.12)}
    .r-dang{color:#ff4757;border-color:#ff4757;background:rgba(255,71,87,.12)}

    /* Anima√ß√µes de queda */
    .worker.fall-safe{animation:fallSafe 2s cubic-bezier(.1,.7,.5,1) forwards}
    .worker.fall-warn{animation:fallWarn 2.2s cubic-bezier(.2,.8,.4,1) forwards}
    .worker.fall-dang{animation:fallDang 2.5s cubic-bezier(.5,.05,.6,.2) forwards}
    @keyframes fallSafe{0%{transform:translateY(0)}30%{transform:translateY(var(--fall)) rotate(12deg)}80%{transform:translateY(calc(var(--fall)*.9))}100%{transform:translateY(calc(var(--fall)*.86))}}
    @keyframes fallWarn{0%{transform:translateY(0)}40%{transform:translateY(var(--fall)) rotate(22deg)}100%{transform:translateY(calc(var(--fall)*.9))}}
    @keyframes fallDang{0%{transform:translateY(0)}100%{transform:translateY(var(--fall)) rotate(90deg)}}
  </style>
</head>
<body>
  <header class="header">
    <div>
      <h1>Simulador Virtual NR-35</h1>
      <div id="hdrStatus" class="badge">CEN√ÅRIO SEGURO</div>
    </div>
  </header>

  <main class="main">
    <aside class="panel">
      <div class="title">Par√¢metros da Simula√ß√£o</div>

      <div class="label">Altura do Trabalho</div>
      <div class="row">
        <input id="altura" class="slider" type="range" min="2" max="20" step="0.5" value="8">
        <input id="alturaIn" class="input" type="number" min="2" max="20" step="0.5" value="8">
      </div>
      <div class="hint">Altura dos p√©s do trabalhador em rela√ß√£o ao ch√£o.</div>

      <div class="label" style="margin-top:10px">Comprimento do Talabarte</div>
      <div class="row">
        <input id="talabarte" class="slider" type="range" min="0.9" max="2.0" step="0.1" value="1.3">
        <input id="talabarteIn" class="input" type="number" min="0.9" max="2.0" step="0.1" value="1.3">
      </div>
      <div class="hint">Em metros (para SRL, √© ignorado no c√°lculo da dist√¢ncia).</div>

      <div class="label" style="margin-top:10px">Tipo de EPI</div>
      <select id="epi" class="select">
        <option value="completo">Cinto Paraquedista + Talabarte com Absorvedor</option>
        <option value="sem">Cinto Paraquedista + Talabarte sem Absorvedor</option>
        <option value="abd">Cinto Abdominal (inadequado)</option>
        <option value="srl">SRL (Trava-Quedas Retr√°til)</option>
      </select>

      <div class="label" style="margin-top:10px">Tipo de Ancoragem</div>
      <select id="ancoragem" class="select">
        <option value="overhead">Sobre a Cabe√ßa (linha de vida)</option>
        <option value="srl">SRL Vertical (ponto alto fixo)</option>
        <option value="lateral">Lateral Pr√≥xima (‚â§ 0,6 m)</option>
      </select>

      <div class="title" style="margin-top:14px">Indicadores de Seguran√ßa</div>
      <div class="kpis">
        <div class="kpi"><div class="t">Zona Livre de Queda</div><div class="v" id="vZLQ">4.1m</div><div class="tag safe" id="sZLQ">SEGURO</div></div>
        <div class="kpi"><div class="t">Fator de Queda</div><div class="v" id="vFQ">1.0</div><div class="tag warn" id="sFQ">M√âDIO</div></div>
        <div class="kpi"><div class="t">For√ßa de Impacto</div><div class="v" id="vFI">4.2kN</div><div class="tag safe" id="sFI">ACEIT√ÅVEL</div></div>
        <div class="kpi"><div class="t">N√≠vel de Risco</div><div class="v" id="vR">BAIXO</div><div class="tag safe" id="sR">SEGURO</div></div>
      </div>

      <div class="grid2">
        <button id="btSim" class="btn btn-primary">‚ö° SIMULAR QUEDA</button>
        <button id="btReset" class="btn btn-ghost">üîÑ RESETAR</button>
      </div>
    </aside>

    <section class="panel" style="padding:0">
      <div id="stage" class="stage">
        <div class="building"></div>
        <div class="grid"></div>
        <div class="ground"></div>

        <div id="platform" class="platform"></div>

        <!-- Cart√µes das ancoragens (JS posiciona para colar FQ=1 no cinto) -->
        <div id="anchors" class="anchors">
          <div id="aSup" class="anchor"><div class="icon"></div><div class="label">ACIMA<br>FQ &lt; 1</div></div>
          <div id="aMed" class="anchor selected"><div class="icon"></div><div class="label">N√çVEL<br>FQ = 1</div></div>
          <div id="aInf" class="anchor"><div class="icon"></div><div class="label">ABAIXO<br>FQ = 2</div></div>
        </div>

        <!-- SVG da ‚Äúcorda‚Äù com Bezier -->
        <svg id="ropeSvg" class="ropeSvg" viewBox="0 0 100 100" preserveAspectRatio="none">
          <defs>
            <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
              <feGaussianBlur stdDeviation="2" result="b"/>
              <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
          </defs>
          <path id="ropePath" d="M0,0 Q0,0 0,0" stroke="#ffb800" stroke-width="4" fill="none" filter="url(#glow)"/>
        </svg>
        <div id="distBadge" class="dist-badge" style="display:none">0.0 m</div>

        <!-- Trabalhador -->
        <div id="worker" class="worker" aria-label="Trabalhador">
          <svg class="svg" viewBox="0 0 80 180" xmlns="http://www.w3.org/2000/svg">
            <circle cx="40" cy="25" r="12" fill="#ffdbac" stroke="#d4a574" stroke-width="2"/>
            <ellipse cx="40" cy="20" rx="14" ry="8" fill="#ff6b35" stroke="#d4531f" stroke-width="2"/>
            <rect x="30" y="35" width="20" height="40" rx="5" fill="#4a90e2" stroke="#2e5c8a" stroke-width="2"/>
            <!-- Cinta / ponto de conex√£o (~ y=52) -->
            <rect x="28" y="45" width="24" height="15" rx="3" fill="#ffd700" stroke="#ccaa00" stroke-width="2" opacity=".9"/>
            <rect x="20" y="40" width="8" height="25" rx="4" fill="#ffdbac" stroke="#d4a574" stroke-width="2"/>
            <rect x="52" y="40" width="8" height="25" rx="4" fill="#ffdbac" stroke="#d4a574" stroke-width="2"/>
            <rect x="32" y="75" width="6" height="35" rx="3" fill="#2c3e50" stroke="#1a252f" stroke-width="2"/>
            <rect x="42" y="75" width="6" height="35" rx="3" fill="#2c3e50" stroke="#1a252f" stroke-width="2"/>
            <ellipse cx="35" cy="115" rx="8" ry="4" fill="#8b4513" stroke="#5d2e0a" stroke-width="2"/>
            <ellipse cx="45" cy="115" rx="8" ry="4" fill="#8b4513" stroke="#5d2e0a" stroke-width="2"/>
            <circle cx="40" cy="52" r="3" fill="#ff0000" stroke="#cc0000" stroke-width="1"/>
          </svg>
        </div>

        <div id="result" class="result r-safe">CEN√ÅRIO SEGURO</div>
      </div>
    </section>
  </main>

  <script>
    // utilit√°rios
    const clamp=(v,min,max)=>Math.min(Math.max(v,min),max);
    const map=(v,a,b,c,d)=>c+((clamp(v,a,b)-a)*(d-c))/(b-a);

    class Simulador{
      constructor(){
        // inputs
        this.altura=document.getElementById('altura');
        this.alturaIn=document.getElementById('alturaIn');
        this.talabarte=document.getElementById('talabarte');
        this.talabarteIn=document.getElementById('talabarteIn');
        this.epi=document.getElementById('epi');
        this.ancoragem=document.getElementById('ancoragem');

        // cena
        this.stage=document.getElementById('stage');
        this.platform=document.getElementById('platform');
        this.worker=document.getElementById('worker');
        this.ropeSvg=document.getElementById('ropeSvg');
        this.ropePath=document.getElementById('ropePath');
        this.distBadge=document.getElementById('distBadge');
        this.result=document.getElementById('result');
        this.hdrStatus=document.getElementById('hdrStatus');

        // ancoragens
        this.aSup=document.getElementById('aSup');
        this.aMed=document.getElementById('aMed');
        this.aInf=document.getElementById('aInf');
        this.cards=[this.aSup,this.aMed,this.aInf];
        this.ponto=1; // 0=sup, 1=n√≠vel, 2=inf
        this.cards.forEach((el,i)=>el.addEventListener('click',()=>{this.ponto=i;this.cards.forEach(c=>c.classList.remove('selected'));el.classList.add('selected');this.update()}));

        // KPIs
        this.vZLQ=document.getElementById('vZLQ'); this.sZLQ=document.getElementById('sZLQ');
        this.vFQ =document.getElementById('vFQ');  this.sFQ =document.getElementById('sFQ');
        this.vFI =document.getElementById('vFI');  this.sFI =document.getElementById('sFI');
        this.vR  =document.getElementById('vR');   this.sR  =document.getElementById('sR');

        // bot√µes
        document.getElementById('btSim').addEventListener('click',()=>this.simular());
        document.getElementById('btReset').addEventListener('click',()=>this.reset());

        // sincroniza√ß√£o de inputs
        const sync=(a,b)=>a.addEventListener('input',()=>{b.value=a.value;this.update()});
        sync(this.altura,this.alturaIn); sync(this.alturaIn,this.altura);
        sync(this.talabarte,this.talabarteIn); sync(this.talabarteIn,this.talabarte);
        this.epi.addEventListener('change',()=>this.update());
        this.ancoragem.addEventListener('change',()=>this.update());

        this.anim=false;
        this.update();
      }

      // mapeia 2‚Äì20 m para faixa confort√°vel da cena
      posicoes(){
        const h=parseFloat(this.altura.value);
        const base=map(h,2,20,150,530); // bottom da plataforma
        const workerBottom=base+16;
        return {base,workerBottom};
      }

      // ponto do cinto (coordenadas em px dentro do stage)
      pontoCinto(){
        const w=this.worker.getBoundingClientRect();
        const s=this.stage.getBoundingClientRect();
        const x=(w.left-s.left)+(w.width/2);
        const y=(w.top -s.top )+30; // offset ~peitoral/cinta
        return {x,y,stage:s};
      }

      // posiciona cart√µes para que FQ=1 (n√≠vel) fique na altura do cinto
      posicionarCartoes(){
        const {x,y,stage}=this.pontoCinto();
        const cardH=100, off=120;
        const yFQ1=clamp(y-cardH/2,20,stage.height-cardH-20);
        const yFQ0=clamp(yFQ1-off,20,stage.height-cardH-20);
        const yFQ2=clamp(yFQ1+off,20,stage.height-cardH-20);

        // posi√ß√£o horizontal depende do modo de ancoragem
        const modo=this.ancoragem.value;
        const afastMax=60; // px ~ 0,6 m (escala cartoon)
        let leftMed, leftSup, leftInf;

        if(modo==='overhead'){
          leftMed = x-50; // colado no x do trabalhador
          leftSup = x-50; leftInf = x-50;
        }else if(modo==='srl'){
          leftMed = x-50; // SRL acima do trabalhador
          leftSup = x-50; leftInf = x-50;
        }else{ // lateral pr√≥xima
          leftMed = clamp(x-50, x-50-afastMax, x-50+afastMax);
          leftSup = leftMed; leftInf = leftMed;
        }

        Object.assign(this.aMed.style,{left:`${leftMed}px`,top:`${yFQ1}px`});
        Object.assign(this.aSup.style,{left:`${leftSup}px`,top:`${yFQ0}px`});
        Object.assign(this.aInf.style,{left:`${leftInf}px`,top:`${yFQ2}px`});
      }

      // desenha a ‚Äúcorda‚Äù com Bezier suave e badge da dist√¢ncia horizontal
      desenharCorda(){
        const {x,y,stage}=this.pontoCinto();
        const card=[this.aSup,this.aMed,this.aInf][this.ponto].getBoundingClientRect();
        const s=stage;
        const ax=(card.left-s.left)+(card.width/2);
        const ay=(card.top -s.top )+(card.height/2);

        // controle Bezier ‚Äì levemente acima para dar ‚Äúbarriga‚Äù curta
        const cx=(x+ax)/2;
        const cy=Math.min(y,ay)-40;

        // Atualiza viewBox do SVG para pixels do stage
        this.ropeSvg.setAttribute('viewBox',`0 0 ${s.width} ${s.height}`);
        this.ropePath.setAttribute('d',`M ${x},${y} Q ${cx},${cy} ${ax},${ay}`);
        this.ropePath.setAttribute('stroke', '#ffb800');

        // badge de dist√¢ncia horizontal (info UX)
        const dx=Math.abs(ax-x);
        this.distBadge.style.display='block';
        this.distBadge.textContent=`${(dx/100).toFixed(1)} m`;
        this.distBadge.style.left=`${x + (ax-x)/2 - 30}px`;
        this.distBadge.style.top =`${Math.min(y,ay)-28}px`;
      }

      linhaVidaSRL(){
        // para modo SRL vertical, movemos o cart√£o N√çVEL (ponto) para um topo fixo
        const s=this.stage.getBoundingClientRect();
        const w=this.worker.getBoundingClientRect();
        const x=(w.left-s.left)+(w.width/2);
        const yTop = 40; // ponto alto fixo
        Object.assign(this.aMed.style,{left:`${x-50}px`,top:`${yTop}px`});
      }

      linhaIndicadores(R){
        // KPIs + status
        const setTag=(el,cls,txt)=>{el.className=`tag ${cls}`; el.textContent=txt};
        this.vZLQ.textContent=`${R.Z}m`;
        this.vFQ.textContent= R.FQ.toString();
        this.vFI.textContent=`${R.FI}kN`;
        this.vR.textContent = R.niv;

        setTag(this.sZLQ, R.Z<=R.disp?'safe':'dang', R.Z<=R.disp?'SEGURO':'PERIGO');
        setTag(this.sFQ , R.FQ<1?'safe':R.FQ===1?'warn':'dang', R.FQ<1?'BAIXO':R.FQ===1?'M√âDIO':'ALTO');
        setTag(this.sFI , R.FI<=4?'safe':R.FI<=6?'warn':'dang', R.FI<=4?'ACEIT√ÅVEL':R.FI<=6?'ELEVADO':'PERIGOSO');
        setTag(this.sR  , R.res==='safe'?'safe':R.res==='warn'?'warn':'dang', R.res==='safe'?'SEGURO':R.res==='warn'?'ATEN√á√ÉO':'CR√çTICO');

        this.result.className=`result ${R.res==='safe'?'r-safe':R.res==='warn'?'r-warn':'r-dang'}`;
        this.result.textContent= R.res==='safe'?'CEN√ÅRIO SEGURO':R.res==='warn'?'CEN√ÅRIO DE RISCO':'QUEDA FATAL';
        this.hdrStatus.textContent=this.result.textContent;
        this.hdrStatus.className=`badge ${R.res==='safe'?'r-safe':R.res==='warn'?'r-warn':'r-dang'}`;
      }

      calcular(){
        const H=parseFloat(this.altura.value);
        const L=parseFloat(this.talabarte.value);
        const epi=this.epi.value;

        // FQ conforme ponto e EPI (SRL reduz queda livre)
        let Lqueda=L, queda;
        if(this.ancoragem.value==='srl' || epi==='srl'){ // SRL vertical pr√©-tensionado
          Lqueda = Math.max(0.6, L*0.5); // queda efetiva encurtada
        }

        if (this.ponto===0) queda=Math.max(0, Lqueda-2.0);
        else if (this.ponto===1) queda=Lqueda;
        else queda=Lqueda+2.0;

        const FQ= +(queda/Math.max(L,0.1)).toFixed(1);

        // ZLQ necess√°ria (simplificado, conservador)
        const desac = (epi==='completo'||epi==='srl')?1.75:(epi==='sem'?0.1:0.05);
        const folga=0.5, margem=1.0;
        const Z= +(Lqueda+desac+folga+margem).toFixed(1);
        const disp= +H.toFixed(1);

        // For√ßa de impacto (did√°tica)
        let FI;
        if (epi==='completo' || epi==='srl') FI=Math.min(6.0, 2.0+FQ*2.0);
        else if (epi==='sem') FI=4.0+FQ*8.0;
        else FI=15.0;
        FI=+FI.toFixed(1);

        let res='safe', niv='BAIXO';
        if (epi==='abd' || Z>disp){res='dang'; niv='CR√çTICO'}
        else if (FI>6.0 || FQ>=2.0){res='warn'; niv='ALTO'}
        else if (FQ>1.0 || FI>4.0){res='warn'; niv='M√âDIO'}

        return {FQ,Z,disp,FI,res,niv,queda,Lqueda};
      }

      update(){
        if(this.anim) return;

        // posiciona plataforma e trabalhador
        const {base,workerBottom}=this.posicoes();
        this.platform.style.bottom=`${base}px`;
        this.worker.style.bottom=`${workerBottom}px`;
        this.worker.style.left='25%';
        this.distBadge.style.display='none';

        // SRL vertical: eleva ponto antes de posicionar demais
        if(this.ancoragem.value==='srl') this.linhaVidaSRL();

        // cart√µes sempre alinhados ao cinto para FQ=1
        this.posicionarCartoes();

        // c√°lculos + UI
        const R=this.calcular();
        this.linhaIndicadores(R);

        // corda Bezier curta e realista
        this.desenharCorda();

        this.last=R;
      }

      simular(){
        if(this.anim) return;
        this.anim=true;
        const dist=Math.min(this.last.queda*30,460);
        this.worker.style.setProperty('--fall',`${dist}px`);
        const cls=this.last.res==='safe'?'fall-safe':this.last.res==='warn'?'fall-warn':'fall-dang';
        this.worker.classList.add(cls);
        setTimeout(()=>this.reset(), this.last.res==='safe'?2100:2500);
      }

      reset(){
        this.anim=false;
        this.worker.classList.remove('fall-safe','fall-warn','fall-dang');
        this.update();
      }
    }

    window.addEventListener('DOMContentLoaded',()=>new Simulador());
  </script>
</body>
</html>
